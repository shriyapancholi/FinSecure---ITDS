{% extends 'base.html' %}

{% block title %}Sentinel OS: Threat Dashboard{% endblock %}

{% block content %}
    
    <!-- This block ensures there's a small gap below the fixed Navbar -->
    <div class="pt-3"></div>

    <!-- The dashboard content starts here -->
    <div class="container-fluid p-4">
        
        <!-- 1. HEADER ROW: Welcome Message & Integrity Status -->
        <div class="row mb-4 border-bottom pb-2">
            <div class="col-md-8">
                <h2 class="fw-bold" style="color: var(--bs-primary-dark-text);">
                    Sentinel OS: Threat Matrix for User: <span style="color: var(--bs-accent-color);">Admin Yashvi</span>
                </h2> 
            </div>
            <div class="col-md-4 text-end d-flex align-items-center justify-content-end">
                
                <!-- Integrity Status (Dynamic Color) -->
                {% if metrics.is_spike %}
                    <span class="badge bg-danger p-3 fs-6 rounded-pill shadow-sm me-2"><i class="bi bi-x-octagon-fill me-2"></i>Integrity Alert!</span>
                {% else %}
                    <span class="badge bg-success p-3 fs-6 rounded-pill shadow-sm me-2"><i class="bi bi-check-circle-fill me-2"></i>Integrity Status: OK</span>
                {% endif %}

                <!-- Current Date/Time Display (Using Jinja2's 'now' variable) -->
                <span class="badge bg-info p-3 fs-6 rounded-pill shadow-sm"><i class="bi bi-calendar-event me-2"></i>{{ "now" }}</span>
            </div>
        </div>
        
        <!-- 2. STATUS ROW: CPU & Memory Metrics (Showing REAL DATA) -->
        <div class="row mb-4 g-4">
            
            <!-- CPU Card -->
            <div class="col-md-3">
                <div class="card bg-light border-dark h-100 shadow"> 
                    <div class="card-body">
                        <h5 class="card-title text-muted"><i class="bi bi-cpu me-2"></i>CPU Utilization</h5>
                        <!-- Dynamic text color for CPU spike -->
                        <p class="card-text display-4 fw-bold 
                            {% if metrics.is_spike %}text-danger{% else %}text-secondary{% endif %}">
                            {{ metrics.cpu_usage }} %
                        </p> 
                    </div>
                </div>
            </div>
            
            <!-- Memory Card -->
            <div class="col-md-3">
                <div class="card bg-light border-secondary h-100 shadow">
                    <div class="card-body">
                        <h5 class="card-title text-muted"><i class="bi bi-memory me-2"></i>Memory Usage</h5>
                        <p class="card-text display-4 text-secondary fw-bold">{{ metrics.mem_usage }} %</p>
                    </div>
                </div>
            </div>
            
            <!-- Metrics Key Card -->
            <div class="col-md-6">
                <div class="card border-info bg-light h-100 shadow">
                    <div class="card-body">
                        <h5 class="card-title text-info"><i class="bi bi-info-circle-fill me-2"></i>OS Metrics Key</h5>
                        <p class="card-text small text-muted">
                            This area shows real-time metrics collected by **detector.py**. The Integrity Alert badge and CPU reading turn red if CPU exceeds 90% (Rate Spike Detection).
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. MAIN CONTENT ROW: Alerts and Timeline (Placeholders for Teammates' Data) -->
        <div class="row g-4">
            
            <!-- Alerts Feed & Automated Responses (Person C's Data) -->
            <div class="col-md-6">
                <div class="card border-danger shadow-lg h-100">
                    <div class="card-header text-white gradient-header"> 
                        <h5 class="mb-0"><i class="bi bi-exclamation-triangle-fill me-2"></i>Alerts Feed & Automated Responses</h5>
                    </div>
                    <ul class="list-group list-group-flush"> 
                        <li class="list-group-item bg-light text-danger fw-bold">Placeholder: User X account **Suspended** (Rule Violation)</li>
                        <li class="list-group-item bg-light text-warning">Placeholder: Rate Spike Detected (Daemon/Rules)</li>
                        <li class="list-group-item bg-light text-muted">Placeholder: Soft Alert issued to User Y</li>
                    </ul>
                </div>
            </div>

            <!-- Recent User Timeline (Person B's Data) -->
            <div class="col-md-6">
                <div class="card shadow-lg h-100">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0"><i class="bi bi-person-lines-fill me-2"></i>Recent User Timeline (All Actions)</h5>
                    </div>
                    <table class="table table-striped table-hover"> 
                        <thead>
                            <tr class="table-light"><th>Time</th><th>User</th><th>Action</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>10:05:30</td><td>JaneD</td><td>Access outside office hours</td></tr>
                            <tr><td>10:05:00</td><td>JohnS</td><td>Fake Transaction attempt (ML Flagged)</td></tr>
                            <tr><td>10:04:15</td><td>JaneD</td><td>Successful login</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endblock %}