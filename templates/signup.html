{% extends 'base.html' %}
{% block title %}Sign up â€” Sentinel{% endblock %}

{% block content %}
<div class="card-panel auth">
  <h2 style="color:var(--accent);margin-bottom:.5rem;">Create account</h2>
  <div class="muted" style="margin-bottom:1rem;">Choose your role (Admin needs a code).</div>

  <form method="post" novalidate>
    <!-- Username -->
    <div class="mb-3">
      <label class="form-label muted" for="username">Username</label>
      <input id="username" class="form-control" name="username" required autocomplete="username" autofocus>
    </div>

    <!-- Password -->
    <div class="mb-3">
      <label class="form-label muted" for="password">Password</label>
      <div class="position-relative">
        <input id="password" class="form-control" name="password" type="password" required
               minlength="6" autocomplete="new-password">
        <button type="button" id="togglePw"
                class="btn btn-text small"
                style="position:absolute; right:.25rem; top:.25rem;">Show</button>
      </div>
      <small id="capsWarn" class="text-warning" style="display:none;">Caps Lock is ON</small>
    </div>

    <!-- Role -->
    <div class="mb-3">
      <label class="form-label muted">Role</label>
      <div class="d-flex gap-3">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="role" id="rAnalyst" value="analyst" checked>
          <label class="form-check-label" for="rAnalyst">Analyst</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="role" id="rAdmin" value="admin">
          <label class="form-check-label" for="rAdmin">Admin</label>
        </div>
      </div>
    </div>

    <!-- Admin code (only when Admin selected) -->
    <div class="mb-3" id="adminCodeWrap" style="display:none;">
      <label class="form-label muted" for="admin_code">Admin code</label>
      <input id="admin_code" class="form-control" name="admin_code" type="password"
             placeholder="Enter admin signup code" autocomplete="off">
      <div class="form-text">Ask an existing admin for this code.</div>
    </div>

    <button class="btn btn-accent w-100" type="submit">Sign Up</button>
    <div class="small-footer">Already have an account? <a href="{{ url_for('login') }}">Login</a></div>
  </form>
</div>

<script>
  const rAdmin   = document.getElementById('rAdmin');
  const rAnalyst = document.getElementById('rAnalyst');
  const codeWrap = document.getElementById('adminCodeWrap');
  const codeInput = document.getElementById('admin_code');

  function toggleCode(){
    const isAdmin = rAdmin.checked;
    codeWrap.style.display = isAdmin ? 'block' : 'none';
    codeInput.required = isAdmin;     // required only for Admin
    if (!isAdmin) codeInput.value = '';
  }

  rAdmin.addEventListener('change', toggleCode);
  rAnalyst.addEventListener('change', toggleCode);
  toggleCode();

  // Show/Hide password
  const pw = document.getElementById('password');
  const toggle = document.getElementById('togglePw');
  toggle.addEventListener('click', () => {
    const isPw = pw.type === 'password';
    pw.type = isPw ? 'text' : 'password';
    toggle.textContent = isPw ? 'Hide' : 'Show';
    pw.focus();
  });

  // Caps Lock warning
  const caps = document.getElementById('capsWarn');
  pw.addEventListener('keyup', (e) => {
    caps.style.display = e.getModifierState && e.getModifierState('CapsLock') ? 'inline' : 'none';
  });
</script>
{% endblock %}